"""

"""
# modules import
import socket
import argparse
from time import sleep
import configparser

params = configparser.ConfigParser()
params.read('params.ini')

def create_conn(server, port, conn):
    s = socket.socket()
    try:
        s.connect((server, port))
        print('Connection no. ', str(conn), ' opened')

    except Exception as e:
        print(e)
        s = None

    return s


if __name__ == "__main__":
    parser = argparse.ArgumentParser()

    # server
    parser.add_argument('-server', help='Server')
    # port
    parser.add_argument('-port', help='Port')
    # sleep
    parser.add_argument('-sleep', help='Sleep time')
    # number of connections
    parser.add_argument('-conns', help='Number of connections')

    args = parser.parse_args()

    sleep_time = params['PARAMS']['sleep'] if not args.sleep else int(args.sleep)
    conns = params['PARAMS']['conns'] if not args.conns else int(args.conns)

    if not (args.server and args.port):
        print('You must define server address and port')
        server = input('Server: ')
        port = int(input('Port: '))

    else:
        server = args.server
        port = int(args.port)

    sockets = []
    for conn in range(conns):
        sockets.append(create_conn(server, port, conn))
        if not sockets[-1]:
            del sockets[-1]
            break

    print(str(len(sockets)), ' sockets created before connection timeout occured')

    # wait sleep_time and them close all conns
    sleep(sleep_time)
    print('Closing conections...')

    # close connections
    for socket in sockets:
        socket.close()


